<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">Library Management</h1>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="books-tab" data-toggle="tab" href="#books" role="tab">Books</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="readers-tab" data-toggle="tab" href="#readers" role="tab">Readers</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="rentals-tab" data-toggle="tab" href="#rentals" role="tab">Rentals</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="search-tab-book" data-toggle="tab" href="#searchBook" role="tab">Search book</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="search-tab-reader" data-toggle="tab" href="#searchReader" role="tab">Search reader</a>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="books" role="tabpanel">
            <h2>Books</h2>
            <form id="bookForm" class="mb-3">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <input type="text" class="form-control" id="bookTitle" placeholder="Title" required>
                    </div>
                    <div class="form-group col-md-3">
                        <input type="text" class="form-control" id="bookAuthor" placeholder="Author" required>
                    </div>
                    <div class="form-group col-md-2">
                        <input type="number" class="form-control" id="bookQuantity" placeholder="Quantity" required>
                    </div>
                    <div class="form-group col-md-2">
                        <button type="submit" class="btn btn-primary">Add Book</button>
                    </div>
                </div>
            </form>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Quantity</th>
                </tr>
                </thead>
                <tbody id="booksTable">

                </tbody>
            </table>
        </div>
        <div class="tab-pane fade" id="rentals" role="tabpanel">
            <h2>Rent a Book</h2>
            <form id="rentalForm" class="mb-3">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <select class="form-control" id="rentalBookId" required>
                            <!-- Books options will be populated here dynamically -->
                        </select>
                    </div>
                    <div class="form-group col-md-3">
                        <select class="form-control" id="rentalReaderId" required>
                            <!-- Readers options will be populated here dynamically -->
                        </select>
                    </div>
                    <div class="form-group col-md-2">
                        <button type="submit" class="btn btn-primary">Rent Book</button>
                    </div>
                </div>
            </form>
            <h2>Rental Records</h2>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Book ID</th>
                    <th>Book Title</th>
                    <th>Reader ID</th>
                    <th>Reader Name</th>
                    <th>Reader Lastname</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="rentalsTable">
                <!-- Rentals will be added here dynamically -->
                </tbody>
            </table>
        </div>
        <div class="tab-pane fade" id="searchBook" role="tabpanel">
            <h2>Search Books</h2>
            <form id="searchFormBook" class="mb-3">
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <input type="text" class="form-control" id="searchKeywordBook" placeholder="Enter title or author" required>
                    </div>
                    <div class="form-group col-md-2">
                        <button type="submit" class="btn btn-primary">Search</button>
                    </div>
                </div>
            </form>
            <h2>Search Results</h2>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Quantity</th>
                </tr>
                </thead>
                <tbody id="searchResultsTableBook">
                <!-- Search results will be added here dynamically -->
                </tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="searchReader" role="tabpanel">
            <h2>Search readers</h2>
            <form id="searchFormReader" class="mb-3">
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <input type="text" class="form-control" id="searchKeywordReader" placeholder="Enter title or author" required>
                    </div>
                    <div class="form-group col-md-2">
                        <button type="submit" class="btn btn-primary">Search</button>
                    </div>
                </div>
            </form>
            <h2>Search Results</h2>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Lastname</th>
                    <th>Email</th>
                </tr>
                </thead>
                <tbody id="searchResultsTableReader">
                <!-- Search results will be added here dynamically -->
                </tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="readers" role="tabpanel">
            <h2>Readers</h2>
            <form id="readerForm" class="mb-3">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <input type="text" class="form-control" id="readerName" placeholder="Name" required>
                    </div>
                    <div class="form-group col-md-3">
                        <input type="text" class="form-control" id="readerLastname" placeholder="Lastname" required>
                    </div>
                    <div class="form-group col-md-3">
                        <input type="email" class="form-control" id="readerEmail" placeholder="Email" required>
                    </div>
                    <div class="form-group col-md-2">
                        <button type="submit" class="btn btn-primary">Add Reader</button>
                    </div>
                </div>
            </form>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Lastname</th>
                    <th>Email</th>
                </tr>
                </thead>
                <tbody id="readersTable">

                </tbody>
            </table>
        </div>
    </div>
</div>




<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    $(document).ready(function() {
        // Load all books and readers on page load
        loadBooks();
        loadReaders();
        loadRentals();
        populateDropdowns();

        // Add a new book
        $('#bookForm').on('submit', function(event) {
            event.preventDefault();
            const book = [{
                title: $('#bookTitle').val(),
                author: $('#bookAuthor').val(),
                quantity: $('#bookQuantity').val()
            }];
            axios.post('/books', book)
                .then(response => {
                    loadBooks();
                    $('#bookForm')[0].reset();
                })
                .catch(error => console.error(error));
        });

        // Add a new reader
        $('#readerForm').on('submit', function(event) {
            event.preventDefault();
            const reader = [{
                name: $('#readerName').val(),
                lastname: $('#readerLastname').val(),
                email: $('#readerEmail').val()
            }];
            axios.post('/readers', reader)
                .then(response => {
                    loadReaders();
                    $('#readerForm')[0].reset();
                })
                .catch(error => console.error(error));
        });

        // Rent a book
        $('#rentalForm').on('submit', function(event) {
            event.preventDefault();
            const rental = [{
                bookId: $('#rentalBookId').val(),
                readerId: $('#rentalReaderId').val()
            }];
            axios.post('/rentals/rent', rental)
                .then(response => {
                    alert('Zarezerwowano');
                    $('#rentalForm')[0].reset();
                    loadRentals();
                })
                .catch(error => console.error(error));
        });

        // Search for books
        $('#searchFormBook').on('submit', function(event) {
            event.preventDefault();
            const keyword = $('#searchKeywordBook').val();
            axios.get(`/books/search?keyword=${keyword}`)
                .then(response => {
                    const books = response.data;
                    $('#searchResultsTableBook').empty();
                    books.forEach(book => {
                        $('#searchResultsTableBook').append(`
                        <tr>
                            <td>${book.id}</td>
                            <td>${book.title}</td>
                            <td>${book.author}</td>
                            <td>${book.quantity}</td>
                        </tr>
                    `);
                    });
                })
                .catch(error => console.error(error));
        });

        // Search a reader
        $('#searchFormReader').on('submit', function(event) {
            event.preventDefault();
            const keyword = $('#searchKeywordReader').val();
            axios.get(`/readers/search?keyword=${keyword}`)
                .then(response => {
                    const readers = response.data;
                    $('#searchResultsTableReader').empty();
                    readers.forEach(reader => {
                        $('#searchResultsTableReader').append(`
                        <tr>
                            <td>${reader.id}</td>
                            <td>${reader.name}</td>
                            <td>${reader.lastname}</td>
                            <td>${reader.email}</td>
                        </tr>
                    `);
                    });
                })
                .catch(error => console.error(error));
        });

    });

    function loadBooks() {
        axios.get('/books')
            .then(response => {
                const books = response.data;
                $('#booksTable').empty();
                books.forEach(book => {
                    $('#booksTable').append(`
                    <tr>
                        <td>${book.id}</td>
                        <td>${book.title}</td>
                        <td>${book.author}</td>
                        <td>${book.quantity}</td>
                    </tr>
                `);
                });
                populateBookDropdown(books);
            })
            .catch(error => console.error(error));
    }

    function loadReaders() {
        axios.get('/readers')
            .then(response => {
                const readers = response.data;
                $('#readersTable').empty();
                readers.forEach(reader => {
                    $('#readersTable').append(`
                    <tr>
                        <td>${reader.id}</td>
                        <td>${reader.name}</td>
                        <td>${reader.lastname}</td>
                        <td>${reader.email}</td>
                    </tr>
                `);
                });
                populateReaderDropdown(readers);
            })
            .catch(error => console.error(error));
    }

    function loadRentals() {
        axios.get('/rentals')
            .then(response => {
                const rentals = response.data;
                $('#rentalsTable').empty();
                rentals.forEach(rental => {
                    $('#rentalsTable').append(`
                    <tr>
                        <td>${rental.bookId}</td>
                        <td>${rental.bookTitle}</td>
                        <td>${rental.readerId}</td>
                        <td>${rental.readerName}</td>
                        <td>${rental.readerLastname}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteRental(${rental.bookId}, ${rental.readerId})">Delete</button>
                        </td>
                    </tr>
                `);
                });
            })
            .catch(error => console.error(error));
    }

    function populateDropdowns() {
        axios.get('/books')
            .then(response => {
                populateBookDropdown(response.data);
            })
            .catch(error => console.error(error));

        axios.get('/readers')
            .then(response => {
                populateReaderDropdown(response.data);
            })
            .catch(error => console.error(error));
    }

    function populateBookDropdown(books) {
        const dropdown = $('#rentalBookId');
        dropdown.empty();
        books.forEach(book => {
            dropdown.append(`<option value="${book.id}">${book.title}</option>`);
        });
    }

    function populateReaderDropdown(readers) {
        const dropdown = $('#rentalReaderId');
        dropdown.empty();
        readers.forEach(reader => {
            dropdown.append(`<option value="${reader.id}">${reader.name} ${reader.lastname}</option>`);
        });
    }

    function deleteRental(bookId, readerId) {
        axios.delete(`/rentals/delete?bookId=${bookId}&readerId=${readerId}`)
            .then(response => {
                loadRentals();
                alert('Zwrócono książkę!');
            })
            .catch(error => console.error(error));
    }


</script>
</body>
</html>
